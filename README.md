# ![grafton](.github/grafton.png)

Manifold's provider validation tool

[Code of Conduct](./.github/CONDUCT.md) |
[Contribution Guidelines](./.github/CONTRIBUTING.md) |
[CHANGELOG](./CHANGELOG.md)

[![GitHub release](https://img.shields.io/github/tag/manifoldco/grafton.svg?label=latest)](https://github.com/manifoldco/grafton/releases)
[![GoDoc](https://img.shields.io/badge/godoc-reference-blue.svg)](https://godoc.org/github.com/manifoldco/grafton)
[![Travis](https://img.shields.io/travis/manifoldco/grafton/master.svg)](https://travis-ci.org/manifoldco/grafton)
[![Go Report Card](https://goreportcard.com/badge/github.com/manifoldco/grafton)](https://goreportcard.com/report/github.com/manifoldco/grafton)
[![License](https://img.shields.io/badge/license-BSD-blue.svg)](./LICENSE.md)

## Introduction

Grafton is a super simple CLI tool used by service providers (and Manifold) to
test their integrations with Manifold.

Using this CLI tool, a provider can test the following:

- Provisioning of a Resource
- Provisioning of Credentials
- Resizing of a Resource
- Deprovisioning of Credentials
- Deprovisioning of a Resource

Requests generated by Grafton are the exact same shape and style as those made
by the Provisioning service. Using this tool, a provider should be able to
implement and test their integration without needing real requests from any
Manifold services.

## Usage

1. **Generate Keypair**

To use, a provider must generate a local public keypair used for signing
ephemereal live keypairs. This allows `Grafton` to generate and sign requests
using the same algorithms as Manifold.

```
$ grafton generate
```

When a keypair is generated it will be written to a `masterkey.json` file in
the current working directory.

The public key contained in this file can be used by the implemented service
to verify the authenticity of the requests made by Grafton


2. **Run Tests**

Now that a key has been generated, you can run the tests which will provision a
resource, create credentials, create another set of credentials, and then
deprovision those before resizing the resource. Finally, Grafton will
deprovision the resource.

```
$ grafton test --product=generators --plan=low --new-plan=high \
  --region=aws::us-east-1 http://localhost:3000
```

## On editing the OpenAPI spec

`provider.yaml` is a manual copy of an internally generated file. It, in
turn, is used to generate the client code under `generated`.

Until we automate more of this, the following has to be kept in mind:
- Any changes to `provider.yaml` should not be merged here directly, but
  instead ported to the internal file first.
- If the internal source of `provider.yaml` changes, the updates must be brought
  over here.
- Whenever `provider.yaml` changes, `make generated` should be run, and the
  changes to the generated code should be checked in.
